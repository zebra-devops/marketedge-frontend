{"version":3,"sources":["/Users/matt/Sites/MarketEdge/platform-wrapper/frontend/src/services/api.ts"],"sourcesContent":["import axios, { AxiosInstance, AxiosResponse } from 'axios'\nimport Cookies from 'js-cookie'\nimport { TokenResponse, RefreshTokenRequest } from '@/types/auth'\n\nclass ApiService {\n  private client: AxiosInstance\n\n  constructor() {\n    this.client = axios.create({\n      baseURL: process.env.NEXT_PUBLIC_API_BASE_URL + '/api/v1',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n    })\n\n    this.setupInterceptors()\n  }\n\n  private setupInterceptors() {\n    this.client.interceptors.request.use(\n      (config) => {\n        const token = Cookies.get('access_token')\n        if (token) {\n          config.headers.Authorization = `Bearer ${token}`\n        }\n        return config\n      },\n      (error) => Promise.reject(error)\n    )\n\n    this.client.interceptors.response.use(\n      (response) => response,\n      async (error) => {\n        const originalRequest = error.config\n\n        if (error.response?.status === 401 && !originalRequest._retry) {\n          originalRequest._retry = true\n\n          try {\n            const refreshToken = Cookies.get('refresh_token')\n            if (refreshToken) {\n              const response = await this.refreshToken({ refresh_token: refreshToken })\n              Cookies.set('access_token', response.access_token)\n              originalRequest.headers.Authorization = `Bearer ${response.access_token}`\n              return this.client(originalRequest)\n            }\n          } catch (refreshError) {\n            this.clearTokens()\n            window.location.href = '/login'\n          }\n        }\n\n        return Promise.reject(error)\n      }\n    )\n  }\n\n  private clearTokens() {\n    Cookies.remove('access_token')\n    Cookies.remove('refresh_token')\n  }\n\n  async get<T>(url: string): Promise<T> {\n    const response: AxiosResponse<T> = await this.client.get(url)\n    return response.data\n  }\n\n  async post<T>(url: string, data?: any): Promise<T> {\n    const response: AxiosResponse<T> = await this.client.post(url, data)\n    return response.data\n  }\n\n  async put<T>(url: string, data?: any): Promise<T> {\n    const response: AxiosResponse<T> = await this.client.put(url, data)\n    return response.data\n  }\n\n  async delete<T>(url: string): Promise<T> {\n    const response: AxiosResponse<T> = await this.client.delete(url)\n    return response.data\n  }\n\n  async refreshToken(data: RefreshTokenRequest): Promise<{ access_token: string; token_type: string }> {\n    const response = await axios.post(\n      `${process.env.NEXT_PUBLIC_API_BASE_URL}/api/v1/auth/refresh`,\n      data\n    )\n    return response.data\n  }\n}\n\nexport const apiService = new ApiService()"],"names":["apiService","ApiService","constructor","client","axios","create","baseURL","process","env","NEXT_PUBLIC_API_BASE_URL","headers","setupInterceptors","interceptors","request","use","config","token","Cookies","get","Authorization","error","Promise","reject","response","originalRequest","status","_retry","refreshToken","refresh_token","set","access_token","refreshError","clearTokens","window","location","href","remove","url","data","post","put","delete"],"mappings":";;;;+BA2FaA;;;eAAAA;;;8DA3FuC;iEAChC;;;;;;AAGpB,MAAMC;IAGJC,aAAc;QACZ,IAAI,CAACC,MAAM,GAAGC,cAAK,CAACC,MAAM,CAAC;YACzBC,SAASC,QAAQC,GAAG,CAACC,wBAAwB,GAAG;YAChDC,SAAS;gBACP,gBAAgB;YAClB;QACF;QAEA,IAAI,CAACC,iBAAiB;IACxB;IAEQA,oBAAoB;QAC1B,IAAI,CAACR,MAAM,CAACS,YAAY,CAACC,OAAO,CAACC,GAAG,CAClC,CAACC;YACC,MAAMC,QAAQC,iBAAO,CAACC,GAAG,CAAC;YAC1B,IAAIF,OAAO;gBACTD,OAAOL,OAAO,CAACS,aAAa,GAAG,CAAC,OAAO,EAAEH,MAAM,CAAC;YAClD;YACA,OAAOD;QACT,GACA,CAACK,QAAUC,QAAQC,MAAM,CAACF;QAG5B,IAAI,CAACjB,MAAM,CAACS,YAAY,CAACW,QAAQ,CAACT,GAAG,CACnC,CAACS,WAAaA,UACd,OAAOH;YACL,MAAMI,kBAAkBJ,MAAML,MAAM;YAEpC,IAAIK,MAAMG,QAAQ,EAAEE,WAAW,OAAO,CAACD,gBAAgBE,MAAM,EAAE;gBAC7DF,gBAAgBE,MAAM,GAAG;gBAEzB,IAAI;oBACF,MAAMC,eAAeV,iBAAO,CAACC,GAAG,CAAC;oBACjC,IAAIS,cAAc;wBAChB,MAAMJ,WAAW,MAAM,IAAI,CAACI,YAAY,CAAC;4BAAEC,eAAeD;wBAAa;wBACvEV,iBAAO,CAACY,GAAG,CAAC,gBAAgBN,SAASO,YAAY;wBACjDN,gBAAgBd,OAAO,CAACS,aAAa,GAAG,CAAC,OAAO,EAAEI,SAASO,YAAY,CAAC,CAAC;wBACzE,OAAO,IAAI,CAAC3B,MAAM,CAACqB;oBACrB;gBACF,EAAE,OAAOO,cAAc;oBACrB,IAAI,CAACC,WAAW;oBAChBC,OAAOC,QAAQ,CAACC,IAAI,GAAG;gBACzB;YACF;YAEA,OAAOd,QAAQC,MAAM,CAACF;QACxB;IAEJ;IAEQY,cAAc;QACpBf,iBAAO,CAACmB,MAAM,CAAC;QACfnB,iBAAO,CAACmB,MAAM,CAAC;IACjB;IAEA,MAAMlB,IAAOmB,GAAW,EAAc;QACpC,MAAMd,WAA6B,MAAM,IAAI,CAACpB,MAAM,CAACe,GAAG,CAACmB;QACzD,OAAOd,SAASe,IAAI;IACtB;IAEA,MAAMC,KAAQF,GAAW,EAAEC,IAAU,EAAc;QACjD,MAAMf,WAA6B,MAAM,IAAI,CAACpB,MAAM,CAACoC,IAAI,CAACF,KAAKC;QAC/D,OAAOf,SAASe,IAAI;IACtB;IAEA,MAAME,IAAOH,GAAW,EAAEC,IAAU,EAAc;QAChD,MAAMf,WAA6B,MAAM,IAAI,CAACpB,MAAM,CAACqC,GAAG,CAACH,KAAKC;QAC9D,OAAOf,SAASe,IAAI;IACtB;IAEA,MAAMG,OAAUJ,GAAW,EAAc;QACvC,MAAMd,WAA6B,MAAM,IAAI,CAACpB,MAAM,CAACsC,MAAM,CAACJ;QAC5D,OAAOd,SAASe,IAAI;IACtB;IAEA,MAAMX,aAAaW,IAAyB,EAAyD;QACnG,MAAMf,WAAW,MAAMnB,cAAK,CAACmC,IAAI,CAC/B,CAAC,EAAEhC,QAAQC,GAAG,CAACC,wBAAwB,CAAC,oBAAoB,CAAC,EAC7D6B;QAEF,OAAOf,SAASe,IAAI;IACtB;AACF;AAEO,MAAMtC,aAAa,IAAIC"}