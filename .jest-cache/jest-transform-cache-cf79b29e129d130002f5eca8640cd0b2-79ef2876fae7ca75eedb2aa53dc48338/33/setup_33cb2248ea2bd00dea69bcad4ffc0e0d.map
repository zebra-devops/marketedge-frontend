{"version":3,"sources":["/Users/matt/Sites/MarketEdge/platform-wrapper/frontend/src/test-utils/setup.ts"],"sourcesContent":["/**\n * Jest Test Setup for Multi-Tenant Platform Testing\n * \n * Configures:\n * - React Testing Library\n * - Jest DOM matchers\n * - Mock Service Worker\n * - Multi-tenant test environment\n * - Global test utilities\n */\n\nimport React from 'react'\nimport '@testing-library/jest-dom'\nimport { configure } from '@testing-library/react'\nimport { toHaveNoViolations } from 'jest-axe'\nimport { server } from '../__tests__/mocks/server'\n\n// Extend Jest matchers\nexpect.extend(toHaveNoViolations)\n\n// Configure React Testing Library\nconfigure({\n  // Increase timeout for complex multi-tenant scenarios\n  asyncUtilTimeout: 5000,\n  \n  // Custom test ID attribute for better component identification\n  testIdAttribute: 'data-testid',\n  \n  // Show suggestions for better queries\n  showOriginalStackTrace: true,\n})\n\n// Mock Service Worker setup\nbeforeAll(() => {\n  // Start the mocking server\n  server.listen({\n    onUnhandledRequest: 'warn',\n  })\n})\n\nafterEach(() => {\n  // Reset any runtime request handlers we may have added during tests\n  server.resetHandlers()\n  \n  // Clean up any DOM changes\n  document.body.innerHTML = ''\n  \n  // Clear localStorage for multi-tenant isolation\n  localStorage.clear()\n  sessionStorage.clear()\n  \n  // Reset any global state\n  if ((window as any).__PLATFORM_CONFIG__) {\n    delete (window as any).__PLATFORM_CONFIG__\n  }\n})\n\nafterAll(() => {\n  // Stop the mocking server\n  server.close()\n})\n\n// Global test environment setup\nbeforeEach(() => {\n  // Set up default platform configuration for tests\n  (window as any).__PLATFORM_CONFIG__ = {\n    environment: 'test',\n    apiUrl: 'http://localhost:8000',\n    enableDebugMode: true,\n    features: {\n      rateLimit: true,\n      multiTenant: true,\n      analytics: false,\n    },\n  }\n  \n  // Mock console methods to reduce noise in tests\n  jest.spyOn(console, 'error').mockImplementation(() => {})\n  jest.spyOn(console, 'warn').mockImplementation(() => {})\n  jest.spyOn(console, 'info').mockImplementation(() => {})\n})\n\n// Global mocks for browser APIs\nObject.defineProperty(window, 'matchMedia', {\n  writable: true,\n  value: jest.fn().mockImplementation(query => ({\n    matches: false,\n    media: query,\n    onchange: null,\n    addListener: jest.fn(), // deprecated\n    removeListener: jest.fn(), // deprecated\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n    dispatchEvent: jest.fn(),\n  })),\n})\n\n// Mock ResizeObserver\nglobal.ResizeObserver = jest.fn().mockImplementation(() => ({\n  observe: jest.fn(),\n  unobserve: jest.fn(),\n  disconnect: jest.fn(),\n}))\n\n// Mock IntersectionObserver\nglobal.IntersectionObserver = jest.fn().mockImplementation(() => ({\n  observe: jest.fn(),\n  unobserve: jest.fn(),\n  disconnect: jest.fn(),\n  root: null,\n  rootMargin: '',\n  thresholds: [],\n}))\n\n// Mock document event handling for Auth Service activity tracking\nif (typeof document !== 'undefined') {\n  const originalAddEventListener = document.addEventListener\n  const originalRemoveEventListener = document.removeEventListener\n  \n  document.addEventListener = jest.fn((event, handler, options) => {\n    // For test environment, just store the mock but don't actually add listeners\n    // This prevents issues with activity tracking in auth service\n    return jest.fn()\n  })\n  \n  document.removeEventListener = jest.fn((event, handler, options) => {\n    return jest.fn()\n  })\n}\n\n// Mock window event handling\nif (typeof window !== 'undefined') {\n  const originalWindowAddEventListener = window.addEventListener\n  const originalWindowRemoveEventListener = window.removeEventListener\n  \n  window.addEventListener = jest.fn()\n  window.removeEventListener = jest.fn()\n}\n\n// Mock window.location for multi-tenant URL testing\nObject.defineProperty(window, 'location', {\n  writable: true,\n  value: {\n    hostname: 'localhost',\n    port: '3000',\n    protocol: 'http:',\n    pathname: '/',\n    search: '',\n    hash: '',\n    origin: 'http://localhost:3000',\n    href: 'http://localhost:3000',\n    assign: jest.fn(),\n    replace: jest.fn(),\n    reload: jest.fn(),\n  },\n})\n\n// Mock fetch for API calls not handled by MSW\nglobal.fetch = jest.fn()\n\n// Mock next/router for Next.js components\njest.mock('next/router', () => ({\n  useRouter: () => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    back: jest.fn(),\n    query: {},\n    pathname: '/',\n    asPath: '/',\n    route: '/',\n    isReady: true,\n    events: {\n      on: jest.fn(),\n      off: jest.fn(),\n      emit: jest.fn(),\n    },\n  }),\n}))\n\n// Mock next/navigation for App Router\njest.mock('next/navigation', () => ({\n  useRouter: () => ({\n    push: jest.fn(),\n    replace: jest.fn(),\n    back: jest.fn(),\n    forward: jest.fn(),\n    refresh: jest.fn(),\n    prefetch: jest.fn(),\n  }),\n  usePathname: () => '/',\n  useSearchParams: () => new URLSearchParams(),\n  useParams: () => ({}),\n}))\n\n// Mock next/image\njest.mock('next/image', () => ({\n  __esModule: true,\n  default: (props: any) => React.createElement('img', props)\n}))\n\n// Mock Chart.js and recharts for data visualization components\njest.mock('recharts', () => ({\n  ...jest.requireActual('recharts'),\n  ResponsiveContainer: ({ children }: any) => children,\n}))\n\n// Error boundary for testing error scenarios\nexport class TestErrorBoundary extends Error {\n  constructor(message: string) {\n    super(message)\n    this.name = 'TestErrorBoundary'\n  }\n}\n\n// Global error handler for unhandled promise rejections\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.error('Unhandled Rejection at:', promise, 'reason:', reason)\n})\n\n// Suppress specific warnings in tests\nconst originalError = console.error\nbeforeAll(() => {\n  console.error = (...args: any[]) => {\n    if (\n      args[0]?.includes?.('Warning: ReactDOM.render is no longer supported') ||\n      args[0]?.includes?.('Warning: React.createFactory') ||\n      args[0]?.includes?.('act(') ||\n      args[0]?.includes?.('useLayoutEffect does nothing on the server')\n    ) {\n      return\n    }\n    originalError.call(console, ...args)\n  }\n})\n\nafterAll(() => {\n  console.error = originalError\n})\n\n// Global test timeout for async operations\njest.setTimeout(10000)\n\n// Enable fake timers by default for better test control\n// Individual tests can opt-out using jest.useRealTimers()\nbeforeEach(() => {\n  jest.useFakeTimers()\n})\n\nafterEach(() => {\n  jest.runOnlyPendingTimers()\n  jest.useRealTimers()\n})"],"names":["jest","mock","useRouter","push","fn","replace","back","query","pathname","asPath","route","isReady","events","on","off","emit","forward","refresh","prefetch","usePathname","useSearchParams","URLSearchParams","useParams","__esModule","default","props","React","createElement","requireActual","ResponsiveContainer","children","TestErrorBoundary","expect","extend","toHaveNoViolations","configure","asyncUtilTimeout","testIdAttribute","showOriginalStackTrace","beforeAll","server","listen","onUnhandledRequest","afterEach","resetHandlers","document","body","innerHTML","localStorage","clear","sessionStorage","window","__PLATFORM_CONFIG__","afterAll","close","beforeEach","environment","apiUrl","enableDebugMode","features","rateLimit","multiTenant","analytics","spyOn","console","mockImplementation","Object","defineProperty","writable","value","matches","media","onchange","addListener","removeListener","addEventListener","removeEventListener","dispatchEvent","global","ResizeObserver","observe","unobserve","disconnect","IntersectionObserver","root","rootMargin","thresholds","originalAddEventListener","originalRemoveEventListener","event","handler","options","originalWindowAddEventListener","originalWindowRemoveEventListener","hostname","port","protocol","search","hash","origin","href","assign","reload","fetch","Error","constructor","message","name","process","reason","promise","error","originalError","args","includes","call","setTimeout","useFakeTimers","runOnlyPendingTimers","useRealTimers"],"mappings":"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"}